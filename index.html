<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reported Speech: Questions Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #a29bfe; --success: #00b894; --error: #ff7675; --warning: #fdcb6e; }
        body {             
            font-family: 'Poppins', sans-serif; margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?auto=format&fit=crop&w=1920&q=80');
            background-size: cover; color: white; overflow: hidden;
        }
        .quiz-container {             
            background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(15px); padding: 40px; border-radius: 25px;
            width: 95%; max-width: 850px; text-align: center; border: 1px solid rgba(255,255,255,0.1);
            max-height: 90vh; overflow-y: auto;
        }
        #timer { font-size: 1.8rem; color: var(--warning); margin-bottom: 15px; }
        .progress-container { display: flex; height: 8px; width: 100%; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 30px; }
        .progress-segment { flex: 1; border-right: 1px solid rgba(0,0,0,0.2); transition: 0.4s; }
        .direct-quote { font-size: 0.9rem; color: var(--primary); text-transform: uppercase; font-weight: 600; margin-bottom: 10px; }
        .reported-sentence { font-size: 1.3rem; margin-bottom: 30px; }
        input[type="text"] {
            background: transparent; border: none; border-bottom: 2px solid var(--primary); color: #fff;
            font-size: 1.3rem; text-align: center; width: 400px; outline: none; margin-bottom: 10px;
        }
        #next-btn {             
            padding: 15px 45px; background: var(--primary); color: #2d3436; border: none;
            border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; margin-top: 10px;
        }
        .review-item { text-align: left; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 5px solid var(--error); font-size: 0.9rem; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="quiz-container">
    <div id="start-screen">
        <h2 style="color: var(--primary);">Reported Questions Master</h2>
        <p>Convert the direct questions into reported speech.</p>
        <input type="text" id="student-name" placeholder="Enter Full Name" style="width: 80%; border: 2px solid var(--primary); border-radius: 10px; padding: 10px; margin-bottom: 20px;">
        <br>
        <button id="next-btn" onclick="startQuiz()">Start Quiz</button>
    </div>

    <div id="main-quiz" class="hidden">
        <div id="timer">10:00</div>
        <div class="progress-container" id="progress-bar"></div>
        <div id="quiz-content">
            <p class="direct-quote" id="active-text"></p>
            <div class="reported-sentence" id="passive-display"></div>
            <div id="feedback" style="min-height: 50px; font-weight: 600;"></div>
            <button id="next-btn" onclick="handleButtonClick()">Check Answer</button>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzjaoBxGbsuMNHNvenbb_3wAw1XKuGLHSFoSHbvT3NL0zAkFbWSppPQVyYLxjTxCJFp/exec";
    
    const questionBank = [
        // SET 1
        { direct: "Did David finish this report yesterday?", pre: "Sarah asked him", post: ".", ans: ["if David had finished that report the day before", "if David had finished that report the previous day", "whether David had finished that report the day before", "whether David had finished that report the previous day"] },
        { direct: "Will Emma visit Mark next week?", pre: "Mark asked her", post: ".", ans: ["if Emma would visit Mark the following week", "if Emma would visit Mark the next week", "whether Emma would visit Mark the following week", "whether Emma would visit Mark the next week"] },
        { direct: "Why did Laura buy that car?", pre: "Tom asked her", post: ".", ans: ["why Laura had bought that car"] },
        { direct: "Where is Mr. Carter going tomorrow?", pre: "The boss asked him", post: ".", ans: ["where Mr. Carter was going the following day", "where Mr. Carter was going the next day"] },
        { direct: "Do the employees like this new office?", pre: "The manager asked them", post: ".", ans: ["if the employees liked that new office", "whether the employees liked that new office"] },
        { direct: "What did the students do last week?", pre: "The teacher asked them", post: ".", ans: ["what the students had done the week before", "what the students had done the previous week"] },
        { direct: "Can the technician fix this computer?", pre: "Mr. Hassan asked him", post: ".", ans: ["if the technician could fix that computer", "whether the technician could fix that computer"] },
        { direct: "Has Anna seen this movie before?", pre: "Tom asked her", post: ".", ans: ["if Anna had seen that movie before", "whether Anna had seen that movie before"] },
        { direct: "Who called Maria yesterday?", pre: "Maria's mom asked her", post: ".", ans: ["who had called Maria the day before", "who had called Maria the previous day"] },
        { direct: "Is James coming to this party tonight?", pre: "Kevin asked him", post: ".", ans: ["if James was coming to that party that night", "whether James was coming to that party that night"] },

        // SET 2
        { direct: "When will the construction team complete this project?", pre: "The client asked the manager", post: ".", ans: ["when the construction team would complete that project"] },
        { direct: "How did Sofia find this information?", pre: "The teacher asked her", post: ".", ans: ["how Sofia had found that information"] },
        { direct: "Does the secretary know about this meeting tomorrow?", pre: "Mr. Ali asked her", post: ".", ans: ["if the secretary knew about that meeting the following day", "if the secretary knew about that meeting the next day", "whether the secretary knew about that meeting the following day", "whether the secretary knew about that meeting the next day"] },
        { direct: "Why is this door locked?", pre: "The visitor asked the guard", post: ".", ans: ["why that door was locked"] },
        { direct: "Did the guests arrive last week?", pre: "The hotel staff asked the manager", post: ".", ans: ["if the guests had arrived the week before", "if the guests had arrived the previous week", "whether the guests had arrived the week before", "whether the guests had arrived the previous week"] },
        { direct: "Where did Daniel leave this bag?", pre: "The officer asked him", post: ".", ans: ["where Daniel had left that bag"] },
        { direct: "Will Paul help Sara with this tomorrow?", pre: "Sara asked him", post: ".", ans: ["if Paul would help Sara with that the following day", "if Paul would help Sara with that the next day", "whether Paul would help Sara with that the following day", "whether Paul would help Sara with that the next day"] },
        { direct: "What time does this shop open?", pre: "The customer asked the staff", post: ".", ans: ["what time that shop opened"] },
        { direct: "Did Mike see the suspect yesterday?", pre: "The detective asked him", post: ".", ans: ["if Mike had seen the suspect the day before", "if Mike had seen the suspect the previous day", "whether Mike had seen the suspect the day before", "whether Mike had seen the suspect the previous day"] },
        { direct: "Is James using this laptop now?", pre: "The librarian asked him", post: ".", ans: ["if James was using that laptop then", "whether James was using that laptop then", "if James was using that laptop at that moment", "whether James was using that laptop at that moment"] },

        // SET 3
        { direct: "Can Nina speak French?", pre: "The recruiter asked her", post: ".", ans: ["if Nina could speak French", "whether Nina could speak French"] },
        { direct: "Where does Dr. Lee live now?", pre: "The nurse asked him", post: ".", ans: ["where Dr. Lee lived then", "where Dr. Lee lived at that time"] },
        { direct: "Did the audience enjoy this concert last night?", pre: "The organizer asked them", post: ".", ans: ["if the audience had enjoyed that concert the night before", "if the audience had enjoyed that concert the previous night", "whether the audience had enjoyed that concert the night before", "whether the audience had enjoyed that concert the previous night"] },
        { direct: "When did Mr. Brown move to this city?", pre: "The landlord asked him", post: ".", ans: ["when Mr. Brown had moved to that city"] },
        { direct: "Will the team join the conference tomorrow?", pre: "The director asked them", post: ".", ans: ["if the team would join the conference the following day", "if the team would join the conference the next day", "whether the team would join the conference the following day", "whether the team would join the conference the next day"] },
        { direct: "How often do the tourists visit this place?", pre: "The guide asked them", post: ".", ans: ["how often the tourists visited that place"] },
        { direct: "Is Anna working on this project today?", pre: "The manager asked her", post: ".", ans: ["if Anna was working on that project that day", "whether Anna was working on that project that day"] },
        { direct: "What did Mr. Chen think of this proposal?", pre: "The committee asked him", post: ".", ans: ["what Mr. Chen had thought of that proposal"] },
        { direct: "Have the candidates met Dr. Rivera before?", pre: "The interviewer asked them", post: ".", ans: ["if the candidates had met Dr. Rivera before", "whether the candidates had met Dr. Rivera before"] },
        { direct: "Does Rachel want to go to this restaurant tonight?", pre: "Kevin asked her", post: ".", ans: ["if Rachel wanted to go to that restaurant that night", "whether Rachel wanted to go to that restaurant that night"] },

        // SET 4
        { direct: "Why didn't Jack call Maria yesterday?", pre: "Maria asked him", post: ".", ans: ["why Jack had not called Maria the day before", "why Jack had not called Maria the previous day", "why Jack hadn't called Maria the day before", "why Jack hadn't called Maria the previous day"] },
        { direct: "Can Mr. Patel come to this meeting tomorrow?", pre: "The boss asked him", post: ".", ans: ["if Mr. Patel could come to that meeting the following day", "if Mr. Patel could come to that meeting the next day", "whether Mr. Patel could come to that meeting the following day", "whether Mr. Patel could come to that meeting the next day"] },
        { direct: "Where is Lisa staying now?", pre: "The receptionist asked her", post: ".", ans: ["where Lisa was staying then", "where Lisa was staying at that time"] },
        { direct: "Did the workers finish this task last week?", pre: "The supervisor asked them", post: ".", ans: ["if the workers had finished that task the week before", "if the workers had finished that task the previous week", "whether the workers had finished that task the week before", "whether the workers had finished that task the previous week"] },
        { direct: "What is the inspector doing here today?", pre: "The manager asked him", post: ".", ans: ["what the inspector was doing there that day"] },
        { direct: "Will Mr. Davis be available next month?", pre: "The client asked him", post: ".", ans: ["if Mr. Davis would be available the following month", "if Mr. Davis would be available the next month", "whether Mr. Davis would be available the following month", "whether Mr. Davis would be available the next month"] },
        { direct: "How did the candidate learn about this opportunity?", pre: "The interviewer asked him", post: ".", ans: ["how the candidate had learned about that opportunity", "how the candidate had learnt about that opportunity"] },
        { direct: "Are these documents ready now?", pre: "The director asked the assistant", post: ".", ans: ["if those documents were ready then", "whether those documents were ready then", "if those documents were ready at that moment", "whether those documents were ready at that moment"] },
        { direct: "Does the witness remember this incident?", pre: "The police officer asked her", post: ".", ans: ["if the witness remembered that incident", "whether the witness remembered that incident"] },
        { direct: "When can the new employee start working here?", pre: "The HR manager asked him", post: ".", ans: ["when the new employee could start working there"] },

        // SET 5
        { direct: "Has Mr. Lopez been to this country before?", pre: "The border officer asked him", post: ".", ans: ["if Mr. Lopez had been to that country before", "whether Mr. Lopez had been to that country before"] },
        { direct: "Why is Dr. Kim leaving this job?", pre: "The director asked her", post: ".", ans: ["why Dr. Kim was leaving that job"] },
        { direct: "Did the secretary receive the email yesterday?", pre: "The manager asked her", post: ".", ans: ["if the secretary had received the email the day before", "if the secretary had received the email the previous day", "whether the secretary had received the email the day before", "whether the secretary had received the email the previous day"] },
        { direct: "Where will the family go next summer?", pre: "The travel agent asked them", post: ".", ans: ["where the family would go the following summer", "where the family would go the next summer"] },
        { direct: "Can the student use this computer now?", pre: "The librarian asked him", post: ".", ans: ["if the student could use that computer then", "whether the student could use that computer then", "if the student could use that computer at that moment", "whether the student could use that computer at that moment"] },
        { direct: "What time did the suspect arrive yesterday?", pre: "The detective asked the witness", post: ".", ans: ["what time the suspect had arrived the day before", "what time the suspect had arrived the previous day"] },
        { direct: "Are the Johnsons planning to buy this house?", pre: "The real estate agent asked them", post: ".", ans: ["if the Johnsons were planning to buy that house", "whether the Johnsons were planning to buy that house"] },
        { direct: "How long has Mr. Green lived here?", pre: "The neighbor asked him", post: ".", ans: ["how long Mr. Green had lived there"] },
        { direct: "Will Dr. Patel attend this conference next week?", pre: "The organizer asked him", post: ".", ans: ["if Dr. Patel would attend that conference the following week", "if Dr. Patel would attend that conference the next week", "whether Dr. Patel would attend that conference the following week", "whether Dr. Patel would attend that conference the next week"] },
        { direct: "Does the student need help with this assignment today?", pre: "The teacher asked her", post: ".", ans: ["if the student needed help with that assignment that day", "whether the student needed help with that assignment that day"] },

        // SET 6
        { direct: "What did the athlete learn from this experience?", pre: "The coach asked him", post: ".", ans: ["what the athlete had learned from that experience", "what the athlete had learnt from that experience"] },
        { direct: "Can the speaker speak louder?", pre: "The audience asked him", post: ".", ans: ["if the speaker could speak louder", "whether the speaker could speak louder"] },
        { direct: "Did the travelers enjoy this trip last month?", pre: "The tour guide asked them", post: ".", ans: ["if the travelers had enjoyed that trip the month before", "if the travelers had enjoyed that trip the previous month", "whether the travelers had enjoyed that trip the month before", "whether the travelers had enjoyed that trip the previous month"] },
        { direct: "Where did Emma park the car?", pre: "The officer asked her", post: ".", ans: ["where Emma had parked the car"] },
        { direct: "Will Tom join this team tomorrow?", pre: "The captain asked him", post: ".", ans: ["if Tom would join that team the following day", "if Tom would join that team the next day", "whether Tom would join that team the following day", "whether Tom would join that team the next day"] },
        { direct: "Is the patient feeling better today?", pre: "The doctor asked him", post: ".", ans: ["if the patient was feeling better that day", "whether the patient was feeling better that day"] },
        { direct: "How much does this product cost?", pre: "The customer asked the salesperson", post: ".", ans: ["how much that product cost"] },
        { direct: "Has the applicant completed this form?", pre: "The clerk asked her", post: ".", ans: ["if the applicant had completed that form", "whether the applicant had completed that form"] },
        { direct: "When did the witness last see the victim?", pre: "The detective asked her", post: ".", ans: ["when the witness had last seen the victim"] },
        { direct: "Does the client want to reschedule this appointment?", pre: "The receptionist asked him", post: ".", ans: ["if the client wanted to reschedule that appointment", "whether the client wanted to reschedule that appointment"] },

        // SET 7
        { direct: "Why are the owners selling this house now?", pre: "The buyer asked them", post: ".", ans: ["why the owners were selling that house then", "why the owners were selling that house at that time"] },
        { direct: "Can Mrs. Taylor join the group for dinner tonight?", pre: "Mr. Taylor asked her", post: ".", ans: ["if Mrs. Taylor could join the group for dinner that night", "whether Mrs. Taylor could join the group for dinner that night"] },
        { direct: "Where did Pedro study last year?", pre: "The professor asked him", post: ".", ans: ["where Pedro had studied the year before", "where Pedro had studied the previous year"] },
        { direct: "Will the client bring this document tomorrow?", pre: "The lawyer asked him", post: ".", ans: ["if the client would bring that document the following day", "if the client would bring that document the next day", "whether the client would bring that document the following day", "whether the client would bring that document the next day"] },
        { direct: "Is Ms. Wright working from home today?", pre: "The supervisor asked her", post: ".", ans: ["if Ms. Wright was working from home that day", "whether Ms. Wright was working from home that day"] },
        { direct: "What happened at this meeting yesterday?", pre: "The director asked the team leader", post: ".", ans: ["what had happened at that meeting the day before", "what had happened at that meeting the previous day"] },
        { direct: "Does the staff have this information now?", pre: "The manager asked them", post: ".", ans: ["if the staff had that information then", "whether the staff had that information then", "if the staff had that information at that moment", "whether the staff had that information at that moment"] },
        { direct: "How did Kevin solve this problem?", pre: "The teacher asked him", post: ".", ans: ["how Kevin had solved that problem"] },
        { direct: "Has Mr. Hughes spoken to the director recently?", pre: "The assistant asked him", post: ".", ans: ["if Mr. Hughes had spoken to the director recently", "whether Mr. Hughes had spoken to the director recently"] },
        { direct: "When will Mrs. Evans return from this trip?", pre: "The secretary asked her", post: ".", ans: ["when Mrs. Evans would return from that trip"] },

        // SET 8
        { direct: "Can the professor explain this concept to the students?", pre: "The students asked him", post: ".", ans: ["if the professor could explain that concept to the students", "whether the professor could explain that concept to the students"] },
        { direct: "Did the participants attend this workshop last week?", pre: "The organizer asked them", post: ".", ans: ["if the participants had attended that workshop the week before", "if the participants had attended that workshop the previous week", "whether the participants had attended that workshop the week before", "whether the participants had attended that workshop the previous week"] },
        { direct: "Where is Dr. Nguyen working now?", pre: "The hospital asked him", post: ".", ans: ["where Dr. Nguyen was working then", "where Dr. Nguyen was working at that time"] },
        { direct: "Will the courier deliver this package tomorrow?", pre: "The customer asked the company", post: ".", ans: ["if the courier would deliver that package the following day", "if the courier would deliver that package the next day", "whether the courier would deliver that package the following day", "whether the courier would deliver that package the next day"] },
        { direct: "What is Alex planning to do next year?", pre: "The counselor asked him", post: ".", ans: ["what Alex was planning to do the following year", "what Alex was planning to do the next year"] },
        { direct: "Are these results accurate?", pre: "The scientist asked the lab assistant", post: ".", ans: ["if those results were accurate", "whether those results were accurate"] },
        { direct: "How long did the patients wait here yesterday?", pre: "The nurse asked them", post: ".", ans: ["how long the patients had waited there the day before", "how long the patients had waited there the previous day"] },
        { direct: "Does the new employee understand this instruction?", pre: "The trainer asked him", post: ".", ans: ["if the new employee understood that instruction", "whether the new employee understood that instruction"] },
        { direct: "When did Maria finish this book?", pre: "The librarian asked her", post: ".", ans: ["when Maria had finished that book"] },
        { direct: "Will the board support this proposal?", pre: "The committee asked them", post: ".", ans: ["if the board would support that proposal", "whether the board would support that proposal"] },

        // SET 9
        { direct: "Has the intern checked this email today?", pre: "The boss asked him", post: ".", ans: ["if the intern had checked that email that day", "whether the intern had checked that email that day"] },
        { direct: "Why did the manager choose this option?", pre: "The director asked her", post: ".", ans: ["why the manager had chosen that option"] },
        { direct: "Can the partners discuss this matter now?", pre: "The lawyer asked them", post: ".", ans: ["if the partners could discuss that matter then", "whether the partners could discuss that matter then", "if the partners could discuss that matter at that moment", "whether the partners could discuss that matter at that moment"] },
        { direct: "Where will the journalist be next month?", pre: "The editor asked her", post: ".", ans: ["where the journalist would be the following month", "where the journalist would be the next month"] },
        { direct: "Did the staff notice this change yesterday?", pre: "The manager asked them", post: ".", ans: ["if the staff had noticed that change the day before", "if the staff had noticed that change the previous day", "whether the staff had noticed that change the day before", "whether the staff had noticed that change the previous day"] },
        { direct: "Is Mr. Karim interested in this position?", pre: "The HR manager asked him", post: ".", ans: ["if Mr. Karim was interested in that position", "whether Mr. Karim was interested in that position"] },
        { direct: "What time does this train leave?", pre: "The passenger asked the conductor", post: ".", ans: ["what time that train left"] },
        { direct: "How many people attended this event last night?", pre: "The reporter asked the organizer", post: ".", ans: ["how many people had attended that event the night before", "how many people had attended that event the previous night"] },
        { direct: "Will Sarah bring the laptop tomorrow?", pre: "The teacher asked her", post: ".", ans: ["if Sarah would bring the laptop the following day", "if Sarah would bring the laptop the next day", "whether Sarah would bring the laptop the following day", "whether Sarah would bring the laptop the next day"] },
        { direct: "Do the participants have any questions about this topic?", pre: "The presenter asked them", post: ".", ans: ["if the participants had any questions about that topic", "whether the participants had any questions about that topic"] },

        // SET 10
        { direct: "Can Mr. Walsh recommend this restaurant?", pre: "A tourist asked him", post: ".", ans: ["if Mr. Walsh could recommend that restaurant", "whether Mr. Walsh could recommend that restaurant"] },
        { direct: "Where did the detective meet the informant yesterday?", pre: "The captain asked him", post: ".", ans: ["where the detective had met the informant the day before", "where the detective had met the informant the previous day"] },
        { direct: "Will the IT team upgrade this system next week?", pre: "The IT manager asked them", post: ".", ans: ["if the technician would upgrade that system the following week", "if the technician would upgrade that system the next week", "whether the technician would upgrade that system the following week", "whether the technician would upgrade that system the next week"] },
        { direct: "Are the customers satisfied with this service?", pre: "The company asked them", post: ".", ans: ["if the customers were satisfied with that service", "whether the customers were satisfied with that service"] },
        { direct: "What did the delegates discuss at this meeting last week?", pre: "The ambassador asked them", post: ".", ans: ["what the delegates had discussed at that meeting the week before", "what the delegates had discussed at that meeting the previous week"] },
        { direct: "How often does Mrs. Park use this application?", pre: "The developer asked her", post: ".", ans: ["how often Mrs. Park used that application"] },
        { direct: "Did the employee back up this file yesterday?", pre: "The manager asked her", post: ".", ans: ["if the employee had backed up that file the day before", "if the employee had backed up that file the previous day", "whether the employee had backed up that file the day before", "whether the employee had backed up that file the previous day"] },
        { direct: "When can Mr. Torres submit this report?", pre: "The director asked him", post: ".", ans: ["when Mr. Torres could submit that report"] },
        { direct: "Have the representatives contacted the suppliers recently?", pre: "The CEO asked them", post: ".", ans: ["if the representatives had contacted the suppliers recently", "whether the representatives had contacted the suppliers recently"] },
        { direct: "Does the technician need this equipment today?", pre: "The supervisor asked him", post: ".", ans: ["if the technician needed that equipment that day", "whether the technician needed that equipment that day"] },

        // SET 11
        { direct: "Why is the customer closing this account now?", pre: "The banker asked him", post: ".", ans: ["why the customer was closing that account then", "why the customer was closing that account at that time"] },
        { direct: "Can Maria translate this document for the team?", pre: "The manager asked her", post: ".", ans: ["if Maria could translate that document for the team", "whether Maria could translate that document for the team"] },
        { direct: "Where did Mr. Reed hear about this news?", pre: "The journalist asked him", post: ".", ans: ["where Mr. Reed had heard about that news"] },
        { direct: "Will the employees attend this training tomorrow?", pre: "The coordinator asked them", post: ".", ans: ["if the employees would attend that training the following day", "if the employees would attend that training the next day", "whether the employees would attend that training the following day", "whether the employees would attend that training the next day"] },
        { direct: "Is the director happy with this decision?", pre: "The board asked him", post: ".", ans: ["if the director was happy with that decision", "whether the director was happy with that decision"] },
        { direct: "What happened during this presentation yesterday?", pre: "The manager asked the speaker", post: ".", ans: ["what had happened during that presentation the day before", "what had happened during that presentation the previous day"] },
        { direct: "Does the user remember this password?", pre: "The system asked him", post: ".", ans: ["if the user remembered that password", "whether the user remembered that password"] },
        { direct: "How did the hacker access this file?", pre: "The admin asked the investigator", post: ".", ans: ["how the hacker had accessed that file"] },
        { direct: "Has the lawyer reviewed this contract yet?", pre: "The client asked him", post: ".", ans: ["if the lawyer had reviewed that contract yet", "whether the lawyer had reviewed that contract yet"] },
        { direct: "When will the company launch this product?", pre: "The journalist asked the CEO", post: ".", ans: ["when the company would launch that product"] },

        // SET 12
        { direct: "Can the driver take the passengers to this location today?", pre: "The passengers asked him", post: ".", ans: ["if the driver could take the passengers to that location that day", "whether the driver could take the passengers to that location that day"] },
        { direct: "Did the students understand this lesson yesterday?", pre: "The teacher asked them", post: ".", ans: ["if the students had understood that lesson the day before", "if the students had understood that lesson the previous day", "whether the students had understood that lesson the day before", "whether the students had understood that lesson the previous day"] },
        { direct: "Where is the family going for vacation next month?", pre: "The neighbor asked them", post: ".", ans: ["where the family was going for vacation the following month", "where the family was going for vacation the next month"] },
        { direct: "Will the board approve this budget tomorrow?", pre: "The accountant asked them", post: ".", ans: ["if the board would approve that budget the following day", "if the board would approve that budget the next day", "whether the board would approve that budget the following day", "whether the board would approve that budget the next day"] },
        { direct: "What is Ms. Novak working on now?", pre: "The manager asked her", post: ".", ans: ["what Ms. Novak was working on then", "what Ms. Novak was working on at that time", "what Ms. Novak was working on at that moment"] },
        { direct: "Are these measurements correct?", pre: "The engineer asked the assistant", post: ".", ans: ["if those measurements were correct", "whether those measurements were correct"] },
        { direct: "How long have the workers been waiting here?", pre: "The foreman asked them", post: ".", ans: ["how long the workers had been waiting there"] },
        { direct: "Does the council agree with this policy?", pre: "The mayor asked them", post: ".", ans: ["if the council agreed with that policy", "whether the council agreed with that policy"] },
        { direct: "When did the team last update this software?", pre: "The IT specialist asked them", post: ".", ans: ["when the team had last updated that software"] },
        { direct: "Will Ms. Flores participate in this event next week?", pre: "The coordinator asked her", post: ".", ans: ["if Ms. Flores would participate in that event the following week", "if Ms. Flores would participate in that event the next week", "whether Ms. Flores would participate in that event the following week", "whether Ms. Flores would participate in that event the next week"] },

        // SET 13 (bonus)
        { direct: "Has the intern completed this task today?", pre: "The supervisor asked him", post: ".", ans: ["if the intern had completed that task that day", "whether the intern had completed that task that day"] },
        { direct: "Why did the board reject this offer?", pre: "The CEO asked them", post: ".", ans: ["why the board had rejected that offer"] },
        { direct: "Can the friends meet at this cafe tomorrow?", pre: "Lucy asked them", post: ".", ans: ["if the friends could meet at that cafe the following day", "if the friends could meet at that cafe the next day", "whether the friends could meet at that cafe the following day", "whether the friends could meet at that cafe the next day"] },
        { direct: "Where will Mr. Yuen study next year?", pre: "The counselor asked him", post: ".", ans: ["where Mr. Yuen would study the following year", "where Mr. Yuen would study the next year"] },
        { direct: "Did Noah receive this message last night?", pre: "Olivia asked him", post: ".", ans: ["if Noah had received that message the night before", "if Noah had received that message the previous night", "whether Noah had received that message the night before", "whether Noah had received that message the previous night"] },
        { direct: "Is the applicant available for this interview tomorrow?", pre: "The recruiter asked her", post: ".", ans: ["if the applicant was available for that interview the following day", "if the applicant was available for that interview the next day", "whether the applicant was available for that interview the following day", "whether the applicant was available for that interview the next day"] },
        { direct: "What time did the suspect leave this building yesterday?", pre: "The detective asked the witness", post: ".", ans: ["what time the suspect had left that building the day before", "what time the suspect had left that building the previous day"] },
        { direct: "How many students are enrolled in this course?", pre: "The dean asked the administrator", post: ".", ans: ["how many students were enrolled in that course"] },
        { direct: "Will the subscriber renew this subscription next month?", pre: "The company asked him", post: ".", ans: ["if the subscriber would renew that subscription the following month", "if the subscriber would renew that subscription the next month", "whether the subscriber would renew that subscription the following month", "whether the subscriber would renew that subscription the next month"] },
        { direct: "Does Mr. Ali know where this office is?", pre: "The visitor asked him", post: ".", ans: ["if Mr. Ali knew where that office was", "whether Mr. Ali knew where that office was"] },

        // SET 14
        { direct: "Can the classmate lend Anna this book today?", pre: "Anna asked him", post: ".", ans: ["if the classmate could lend Anna that book that day", "whether the classmate could lend Anna that book that day"] },
        { direct: "Where did Ben download this application?", pre: "The IT manager asked him", post: ".", ans: ["where Ben had downloaded that application"] },
        { direct: "Will Mrs. Chen sign this contract tomorrow?", pre: "The agent asked her", post: ".", ans: ["if Mrs. Chen would sign that contract the following day", "if Mrs. Chen would sign that contract the next day", "whether Mrs. Chen would sign that contract the following day", "whether Mrs. Chen would sign that contract the next day"] },
        { direct: "Are the students enjoying this class?", pre: "The professor asked them", post: ".", ans: ["if the students were enjoying that class", "whether the students were enjoying that class"] },
        { direct: "What did Mr. Santos order at this restaurant last week?", pre: "The waiter asked him", post: ".", ans: ["what Mr. Santos had ordered at that restaurant the week before", "what Mr. Santos had ordered at that restaurant the previous week"] },
        { direct: "How did the tenants find this apartment?", pre: "The landlord asked them", post: ".", ans: ["how the tenants had found that apartment"] },
        { direct: "Did the assistant save this file yesterday?", pre: "The manager asked her", post: ".", ans: ["if the assistant had saved that file the day before", "if the assistant had saved that file the previous day", "whether the assistant had saved that file the day before", "whether the assistant had saved that file the previous day"] },
        { direct: "When will Sofia move to this city?", pre: "The landlord asked her", post: ".", ans: ["when Sofia would move to that city"] },
        { direct: "Have the children been to this museum before?", pre: "The teacher asked them", post: ".", ans: ["if the children had been to that museum before", "whether the children had been to that museum before"] },
        { direct: "Does the customer prefer this option?", pre: "The salesperson asked him", post: ".", ans: ["if the customer preferred that option", "whether the customer preferred that option"] },

        // SET 15
        { direct: "Why is the client canceling this order now?", pre: "The customer service representative asked him", post: ".", ans: ["why the client was canceling that order then", "why the client was canceling that order at that time", "why the client was cancelling that order then", "why the client was cancelling that order at that time"] },
        { direct: "Can the analyst show the director this report?", pre: "The director asked her", post: ".", ans: ["if the analyst could show the director that report", "whether the analyst could show the director that report"] },
        { direct: "Where did Liam buy this phone?", pre: "Emma asked him", post: ".", ans: ["where Liam had bought that phone"] },
        { direct: "Will the candidate take this exam next week?", pre: "The coordinator asked him", post: ".", ans: ["if the candidate would take that exam the following week", "if the candidate would take that exam the next week", "whether the candidate would take that exam the following week", "whether the candidate would take that exam the next week"] },
        { direct: "Is Mr. Park coming to this event tonight?", pre: "The organizer asked him", post: ".", ans: ["if Mr. Park was coming to that event that night", "whether Mr. Park was coming to that event that night"] },
        { direct: "What happened at this party last night?", pre: "The host asked the neighbors", post: ".", ans: ["what had happened at that party the night before", "what had happened at that party the previous night"] },
        { direct: "Does the technician have this version of the software?", pre: "The manager asked him", post: ".", ans: ["if the technician had that version of the software", "whether the technician had that version of the software"] },
        { direct: "How did the student prepare for this test?", pre: "The teacher asked her", post: ".", ans: ["how the student had prepared for that test"] },
        { direct: "Has the journalist heard about this opportunity yet?", pre: "The editor asked her", post: ".", ans: ["if the journalist had heard about that opportunity yet", "whether the journalist had heard about that opportunity yet"] },
        { direct: "When can the writer finish this assignment?", pre: "The professor asked him", post: ".", ans: ["when the writer could finish that assignment"] }
    ];

    let currentQ = 0, score = 0, quizData = [], timeLeft = 600, timerId;
    let studentName = "", mistakes = [], selectedAttempt = 1;

    function getAttemptNumber(name) {
        const stored = localStorage.getItem('quiz_attempts');
        const attempts = stored ? JSON.parse(stored) : {};
        
        if (!attempts[name]) {
            attempts[name] = 1;
        } else {
            attempts[name]++;
        }
        
        localStorage.setItem('quiz_attempts', JSON.stringify(attempts));
        return attempts[name];
    }

    function startQuiz() {
        studentName = document.getElementById('student-name').value.trim();
        if (!studentName) { alert("Please enter your name."); return; }
        
        selectedAttempt = getAttemptNumber(studentName);
        
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('main-quiz').classList.remove('hidden');
        initQuiz();
    }

    function initQuiz() {
        const startIdx = (selectedAttempt - 1) * 10;
        const endIdx = startIdx + 10;
        quizData = questionBank.slice(startIdx, endIdx);
        
        const bar = document.getElementById('progress-bar');
        bar.innerHTML = '';
        for(let i=0; i<10; i++) {
            let seg = document.createElement('div');
            seg.className = 'progress-segment';
            seg.id = 'seg-'+i;
            bar.appendChild(seg);
        }
        startTimer();
        loadQuestion();
    }

    function startTimer() {
        timerId = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60), s = timeLeft%60;
            document.getElementById('timer').innerText = m + ':' + (s < 10 ? '0'+s : s);
            if(timeLeft <= 0) finish();
        }, 1000);
    }

    function loadQuestion() {
        const q = quizData[currentQ];
        document.getElementById('active-text').innerText = 'Direct: "' + q.direct + '"';
        document.getElementById('passive-display').innerHTML = q.pre + ' <input type="text" id="ans-input" autocomplete="off"> ' + q.post;
        document.getElementById('feedback').innerText = '';
        document.getElementById('ans-input').focus();
        document.getElementById('next-btn').innerText = "Check Answer";
    }

    // Expand contractions so both "hadn't" and "had not" are treated as equal
    function expandContractions(str) {
        return str
            .replace(/hadn't/gi, "had not")
            .replace(/haven't/gi, "have not")
            .replace(/hasn't/gi, "has not")
            .replace(/wouldn't/gi, "would not")
            .replace(/couldn't/gi, "could not")
            .replace(/didn't/gi, "did not")
            .replace(/doesn't/gi, "does not")
            .replace(/don't/gi, "do not")
            .replace(/wasn't/gi, "was not")
            .replace(/weren't/gi, "were not")
            .replace(/isn't/gi, "is not")
            .replace(/aren't/gi, "are not")
            .replace(/won't/gi, "will not")
            .replace(/can't/gi, "cannot")
            .replace(/that's/gi, "that is")
            .replace(/he's/gi, "he is")
            .replace(/she's/gi, "she is")
            .replace(/it's/gi, "it is")
            .replace(/they're/gi, "they are")
            .replace(/we're/gi, "we are")
            .replace(/you're/gi, "you are")
            .replace(/i'm/gi, "i am")
            .replace(/he'd/gi, "he had")
            .replace(/she'd/gi, "she had")
            .replace(/they'd/gi, "they had")
            .replace(/we'd/gi, "we had")
            .replace(/you'd/gi, "you had")
            .replace(/he'll/gi, "he will")
            .replace(/she'll/gi, "she will")
            .replace(/they'll/gi, "they will")
            .replace(/we'll/gi, "we will")
            .replace(/you'll/gi, "you will")
            .replace(/\bcannot\b/gi, "can not")
            .replace(/learnt/gi, "learned")
            .replace(/cancelling/gi, "canceling")
            // Normalize multiple spaces
            .replace(/\s+/g, " ")
            .trim();
    }

    function normalizeAnswer(answer) {
        let normalized = answer.toLowerCase().trim().replace(/[.?!,;]$/g, "");
        // Expand contractions so both short and long forms match
        normalized = expandContractions(normalized);
        return normalized;
    }

    function checkAnswer(userAnswer, correctAnswers) {
        const normalizedUser = normalizeAnswer(userAnswer);
        return correctAnswers.some(ans => normalizeAnswer(ans) === normalizedUser);
    }

    function handleButtonClick() {
        const input = document.getElementById('ans-input');
        if(!input) return;

        if(input.disabled) {
            currentQ++;
            if(currentQ < 10) loadQuestion(); else finish();
            return;
        }

        const user = input.value.trim();
        const correctAnswers = quizData[currentQ].ans;
        const seg = document.getElementById('seg-'+currentQ);

        if(checkAnswer(user, correctAnswers)) {
            document.getElementById('feedback').innerHTML = "<span style='color:var(--success)'>Correct!</span>";
            seg.style.background = 'var(--success)';
            score++;
        } else {
            document.getElementById('feedback').innerHTML = "<span style='color:var(--error)'>Incorrect. Correct answer: ..." + correctAnswers[0] + "</span>";
            seg.style.background = 'var(--error)';
            mistakes.push({ 
                direct: quizData[currentQ].direct, 
                user: user || "(blank)", 
                correct: correctAnswers[0],
                alternatives: correctAnswers.length > 1 ? correctAnswers.slice(1).join(" OR ") : "none"
            });
        }
        input.disabled = true;
        document.getElementById('next-btn').innerText = "Next Question";
    }

    function finish() {
        clearInterval(timerId);
        const percent = (score / 10) * 100;
        
        let analysisHtml = "";
        if(mistakes.length > 0) {
            analysisHtml = '<h3 style="margin-top:20px;">Mistakes Analysis:</h3>';
            mistakes.forEach(m => {
                analysisHtml += '<div class="review-item">';
                analysisHtml += '<strong>Direct:</strong> "' + m.direct + '"<br>';
                analysisHtml += '<span style="color:var(--error); text-decoration:line-through;">Your answer: ' + m.user + '</span><br>';
                analysisHtml += '<span style="color:var(--success);">Correct answer: ' + m.correct + '</span><br>';
                if(m.alternatives !== "none") {
                    analysisHtml += '<span style="color:var(--warning); font-size:0.85rem;">Other accepted answers: ' + m.alternatives + '</span>';
                }
                analysisHtml += '</div>';
            });
        }

        document.getElementById('quiz-content').innerHTML = 
            '<h2>Finished!</h2>' +
            '<p style="font-size:3rem; margin:10px 0;">' + percent + '%</p>' +
            '<p>' + studentName + ', you scored ' + score + '/10 (Attempt ' + selectedAttempt + ')</p>' +
            '<div style="max-height:250px; overflow-y:auto; margin-bottom:20px;">' + analysisHtml + '</div>' +
            '<button onclick="location.reload()" id="next-btn">Try Again</button>';

        try {
            const mistakesText = mistakes.map(m => 
                'Direct: ' + m.direct + ' | User: ' + m.user + ' | Correct: ' + m.correct + ' | Alternatives: ' + m.alternatives
            ).join("\n");
            fetch(SCRIPT_URL, { 
                method: "POST", 
                mode: "no-cors", 
                body: JSON.stringify({ 
                    name: studentName, 
                    score: score, 
                    percentage: percent + "%", 
                    attempt: selectedAttempt,
                    mistakes: mistakesText 
                }) 
            });
        } catch (e) { console.log("Data error"); }
    }
</script>
</body>
</html>
